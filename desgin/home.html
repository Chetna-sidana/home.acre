<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Home</title>

   <!-- font awesome cdn link  -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css">

   <!-- custom css file link  -->
   <link rel="stylesheet" href="css/style.css">
   
  
</head>
<body>
  
   
<!-- header section starts  -->
<header class="header">
   <nav class="navbar nav-1">
      <section class="flex">
         <a href="home.html" class="logo"><i class="fas fa-house"></i>MyHome</a>
         <ul>
            <li><a href="#">post property<i class="fas fa-paper-plane"></i></a></li>
         </ul>
      </section>
      <a href="saved.html">View Saved Properties</a>
   </nav>

   <nav class="navbar nav-2">
      <section class="flex">
         <div id="menu-btn" class="fas fa-bars"></div>
         <div class="menu">
            <ul>
               <li><a href="#">buy<i class="fas fa-angle-down"></i></a>
                  <ul>
                     <li><a href="#">house</a></li>
                     <li><a href="#">flat</a></li>
                     <li><a href="#">shop</a></li>
                     <li><a href="#">ready to move</a></li>
                     <li><a href="#">furnished</a></li>
                  </ul>
               </li>
               <li><a href="#">sell<i class="fas fa-angle-down"></i></a>
                  <ul>
                     <li><a href="#">post property</a></li>
                     <li><a href="#">dashboard</a></li>
                  </ul>
               </li>
               <li><a href="#">help<i class="fas fa-angle-down"></i></a>
                  <ul>
                     <li><a href="about.html">about us</a></li>
                     <li><a href="contact.html">contact us</a></li>
                     <li><a href="contact.html#faq">FAQ</a></li>
                  </ul>
               </li>
            </ul>
         </div>
         <ul>
            <li><a href="#">saved <i class="far fa-heart"></i></a></li>
            <li><a href="#">account <i class="fas fa-angle-down"></i></a>
               <ul>
                  <li><a href="login.html">login</a></li>
                  <li><a href="register.html">register</a></li>
               </ul>
            </li>
         </ul>
      </section>
   </nav>
</header>
<!-- header section ends -->

<!-- home section starts  -->
<div class="home">
   <section class="center">
      <form action="" method="post" onsubmit="fetchAddresses(event)">
         <h3>find your perfect home</h3>
         <div class="box">
            <p>enter location <span>*</span></p>
            <input type="text" name="location" required maxlength="50" placeholder="enter city name" class="input">
         </div>
         <div class="flex">
            <div class="box">
               <p>property type <span>*</span></p>
               <select name="type" class="input" required>
                  <option value="flat">flat</option>
                  <option value="house">house</option>
                  <option value="shop">shop</option>
               </select>
            </div>
            <div class="box">
               <p>how many BHK <span>*</span></p>
               <select name="bhk" class="input" required>
                  <option value="1">1 BHK</option>
                  <option value="2">2 BHK</option>
                  <option value="3">3 BHK</option>
                  <option value="4">4 BHK</option>
                  <option value="5">5 BHK</option>
                  <option value="6">6 BHK</option>
                  <option value="7">7 BHK</option>
                  <option value="8">8 BHK</option>
                  <option value="9">9 BHK</option>
               </select>
            </div>
            <div class="box">
               <p>minimum budget <span>*</span></p>
               <select name="minimum" class="input" required>
                  <option value="500000">5 lac</option>
                  <option value="1000000">10 lac</option>
                  <option value="2000000">20 lac</option>
                  <option value="3000000">30 lac</option>
                  <option value="4000000">40 lac</option>
                  <option value="5000000">50 lac</option>
                  <option value="6000000">60 lac</option>
                  <option value="7000000">70 lac</option>
                  <option value="8000000">80 lac</option>
                  <option value="9000000">90 lac</option>
                  <option value="10000000">1 Cr</option>
                  <option value="20000000">2 Cr</option>
                  <option value="30000000">3 Cr</option>
                  <option value="40000000">4 Cr</option>
                  <option value="50000000">5 Cr</option>
                  <option value="60000000">6 Cr</option>
                  <option value="70000000">7 Cr</option>
                  <option value="80000000">8 Cr</option>
                  <option value="90000000">9 Cr</option>
                  <option value="100000000">10 Cr</option>
                  <option value="150000000">15 Cr</option>
                  <option value="200000000">20 Cr</option>
               </select>
            </div>
            <div class="box">
               <p>maximum budget <span>*</span></p>
               <select name="maximum" class="input" required>
                  <option value="500000">5 lac</option>
                  <option value="1000000">10 lac</option>
                  <option value="2000000">20 lac</option>
                  <option value="3000000">30 lac</option>
                  <option value="4000000">40 lac</option>
                  <option value="5000000">50 lac</option>
                  <option value="6000000">60 lac</option>
                  <option value="7000000">70 lac</option>
                  <option value="8000000">80 lac</option>
                  <option value="9000000">90 lac</option>
                  <option value="10000000">1 Cr</option>
                  <option value="20000000">2 Cr</option>
                  <option value="30000000">3 Cr</option>
                  <option value="40000000">4 Cr</option>
                  <option value="50000000">5 Cr</option>
                  <option value="60000000">6 Cr</option>
                  <option value="70000000">7 Cr</option>
                  <option value="80000000">8 Cr</option>
                  <option value="90000000">9 Cr</option>
                  <option value="100000000">10 Cr</option>
                  <option value="150000000">15 Cr</option>
                  <option value="200000000">20 Cr</option>
               </select>
            </div>
         </div>
         <input type="submit" value="search property" name="search" class="btn">
         <div id="location-coordinates" style="margin-top: 10px; font-size: 14px; color: #555;"></div>
      </form>
   </section>
</div>
<!-- home section ends -->

<!-- services section starts  -->
<section class="services">
   <h1 class="heading">our services</h1>
   <div class="box-container">
      <div class="box">
         <img src="images/icon-1.png" alt="">
         <h3>buy house</h3>
         <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Doloremque, incidunt.</p>
      </div>
      <div class="box">
         <img src="images/icon-2.png" alt="">
         <h3>buy house</h3>
         <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Doloremque, incidunt.</p>
      </div>
      <div class="box">
         <img src="images/icon-3.png" alt="">
         <h3>sell house</h3>
         <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Doloremque, incidunt.</p>
      </div>
      <div class="box">
         <img src="images/icon-4.png" alt="">
         <h3>flats and buildings</h3>
         <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Doloremque, incidunt.</p>
      </div>
      <div class="box">
         <img src="images/icon-5.png" alt="">
         <h3>shops and malls</h3>
         <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Doloremque, incidunt.</p>
      </div>
      <div class="box">
         <img src="images/icon-6.png" alt="">
         <h3>24/7 service</h3>
         <p>Lorem ipsum dolor sit amet consectetur, adipisicing elit. Doloremque, incidunt.</p>
      </div>
   </div>
</section>
<!-- services section ends -->

<!-- listings section starts  -->
<section class="listings">
   <h1 class="heading">latest listings</h1>
   <div class="box-container">
      <!-- Hardcoded listings removed; will be populated dynamically -->
      <!-- You can keep these as a fallback if needed -->
   </div>
   <div style="margin-top: 2rem; text-align:center;">
      <a href="listings.html" class="inline-btn">view all</a>
   </div>
</section>
<!-- listings section ends -->

<!-- footer section starts  -->
<footer class="footer">
   <section class="flex">
      <div class="box">
         <a href="tel:1234567890"><i class="fas fa-phone"></i><span>123456789</span></a>
         <a href="tel:1112223333"><i class="fas fa-phone"></i><span>1112223333</span></a>
         <a href="mailto:shaikhanas@gmail.com"><i class="fas fa-envelope"></i><span>shaikhanas@gmail.com</span></a>
         <a href="#"><i class="fas fa-map-marker-alt"></i><span>mumbai, india - 400104</span></a>
      </div>
      <div class="box">
         <a href="home.html"><span>home</span></a>
         <a href="about.html"><span>about</span></a>
         <a href="contact.html"><span>contact</span></a>
         <a href="listings.html"><span>all listings</span></a>
         <a href="#"><span>saved properties</span></a>
      </div>
      <div class="box">
         <a href="#"><span>facebook</span><i class="fab fa-facebook-f"></i></a>
         <a href="#"><span>twitter</span><i class="fab fa-twitter"></i></a>
         <a href="#"><span>Whatsapp</span><i class="fab fa-linkedin"></i></a>
         <a href="#"><span>instagram</span><i class="fab fa-instagram"></i></a>
      </div>
   </section>
   
</footer>
<!-- footer section ends -->

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js"></script>

<!-- Firebase Initialization and Dynamic Fetching -->
<script>
   // Firebase configuration
   const firebaseConfig = {
      apiKey: "AIzaSyC_KB-fCEA8QQqmDUj2y88Adfr8kx-SgPg",
      authDomain: "login-page-66094.firebaseapp.com",
      projectId: "login-page-66094",
      storageBucket: "login-page-66094.appspot.com",
      messagingSenderId: "173329262844",
      appId: "1:173329262844:web:c25c32cd33a5c1de9f8f79",
      measurementId: "G-973G312R99"
   };

   // Initialize Firebase
   firebase.initializeApp(firebaseConfig);
   const db = firebase.firestore();
   const auth = firebase.auth();

   // Fetch addresses dynamically
   async function fetchAddresses(event) {
      event.preventDefault(); // Prevent form submission from reloading
      const form = event.target;
      const city = form.location.value.trim();
      const type = form.type.value;
      const bhk = form.bhk.value;
      const minBudget = parseInt(form.minimum.value);
      const maxBudget = parseInt(form.maximum.value);

      try {
         const listingsContainer = document.querySelector('.listings .box-container');
         listingsContainer.innerHTML = '<p>Loading properties...</p>'; // Show loading state

         const querySnapshot = await db.collection('AllAddresses')
            .doc(city)
            .collection('addresses')
            .where('type', '==', type)
            .where('bhk', '==', bhk)
            .where('price', '>=', minBudget)
            .where('price', '<=', maxBudget)
            .get();

         listingsContainer.innerHTML = ''; // Clear loading state

         if (querySnapshot.empty) {
            listingsContainer.innerHTML = '<p>No properties found for this city.</p>';
            return;
         }

         querySnapshot.forEach(doc => {
            const data = doc.data();
            const listing = `
               <div class="box">
                  <div class="admin">
                     <h3>${data.name.charAt(0)}</h3>
                     <div>
                        <p>${data.name}</p>
                        <span>10-11-2022</span>
                     </div>
                  </div>
                  <div class="thumb">
                     <p class="total-images"><i class="far fa-image"></i><span>4</span></p>
                     <p class="type"><span>${data.type}</span><span>sale</span></p>
                     <form action="" method="post" class="save">
                        <button type="submit" name="save" class="far fa-heart"></button>
                     </form>
                     <img src="${data.image}" alt="">
                  </div>
                  <h3 class="name">${data.name}</h3>
                  <p class="location"><i class="fas fa-map-marker-alt"></i><span>${data.location}</span></p>
                  <div class="flex">
                     <p><i class="fas fa-bed"></i><span>${data.bedrooms}</span></p>
                     <p><i class="fas fa-bath"></i><span>${data.bathrooms}</span></p>
                     <p><i class="fas fa-maximize"></i><span>${data.size}</span></p>
                  </div>
                  <a href="view_property.html" class="btn">view property</a>
                  <button onclick="saveProperty('${data.name}', '${data.location}', '${data.image}')" class="save-btn">Save</button>
               </div>
            `;
            listingsContainer.innerHTML += listing;
         });
      } catch (error) {
         console.error("Error fetching addresses: ", error);
         listingsContainer.innerHTML = '<p>Error loading properties.</p>';
      }
   }

   function saveProperty(location, propertyType, bhk, budget) {
         firebase.auth().onAuthStateChanged((user) => {
            if (user) {
               db.collection("users").doc(user.uid).collection("saved").add({
                  location: location,
                  propertyType: propertyType,
                  bhk: bhk,
                  budget: budget,
                  timestamp: firebase.firestore.FieldValue.serverTimestamp()
               }).then(() => {
                  alert('Property saved!');
               }).catch(error => {
                  console.error("Error saving property: ", error);
                  alert('Failed to save property.');
               });
            } else {
               alert("You must be logged in to save a property.");
               window.location.href = "login.html";
            }
         });
      }

<!-- Geolocation Script -->
<script>
   const locationInput = document.querySelector('input[name="location"]');
   const coordDisplay = document.getElementById('location-coordinates');

   if (locationInput && coordDisplay) {
      locationInput.addEventListener('blur', async () => {
         const location = locationInput.value.trim();
         if (!location) {
            coordDisplay.innerHTML = '';
            return;
         }

         const apiKey = '1992d0c30a805503a37bdd5ecb5c7eec';
         const url = 'https://api.positionstack.com/v1/forward?access_key=${apiKey}&query=${encodeURIComponent(location)}';

         try {
            const res = await fetch(url);
            const data = await res.json();

            if (data.data && data.data.length > 0) {
               const { latitude, longitude } = data.data[0];
               coordDisplay.innerHTML = '📍 Coordinates: ${latitude.toFixed(5)}, ${longitude.toFixed(5)}';
               addOrUpdateHiddenInput('latitude', latitude);
               addOrUpdateHiddenInput('longitude', longitude);
            } else {
               coordDisplay.innerHTML = '❌ Location not found.';
            }
         } catch (err) {
            coordDisplay.innerHTML = '⚠ Error fetching coordinates.';
            console.error('Geolocation error:', err);
         }
      })
   } else {
      console.error('Location input or coordinates display element not found.')
   }

   function addOrUpdateHiddenInput(name, value) {
      let input = document.querySelector('input[name="${name}"]');
      if (!input) {
         input = document.createElement('input')
         input.type = 'hidden';
         input.name = name;
         document.body.appendChild(input);
      }
   }
      input.value = value;
   
</script>